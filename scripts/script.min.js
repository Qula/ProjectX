$(document).ready(function(){function a(){C=3,R=3,L=6,mb=4,y=0,eb=!1,hb=!1,P=[],V=[],db=[],ib=[],Q=[],J=200,K=470,rb=!0,qb=!1,cb=Math.round(32.5),A.drawImage(F,0,0,E,D),A.drawImage(I,J,K),t(P,S,T),t(V,kb,lb),fb=!1,gb=!0,jb=!1,W=[],X=0,Z=0,Y=0,b()}function b(){"play"==B&&(p(),Y%4===0&&fb&&(fb=!1,t(P,S,T)),Y%5===0&&gb&&(Y%15===0?(jb=!0,t(Q,S,T),gb=!1):(jb=!1,t(Q,S,T),gb=!1)),q(),r(),s(),o(),k(),v(),w(),x(),i(),l(),window.requestAnimationFrame(b,z))}function c(){"pause"==B&&(intervalId=window.requestAnimationFrame(b,z),B="play",j())}function d(){"play"==B&&(B="pause",clearInterval(_))}function e(){B="pause",window.clearInterval(_)}function f(){B="pause",window.clearInterval(_),a(),j(),B="play"}function g(){ub[37]=!1,ub[38]=!1,ub[39]=!1,ub[40]=!1,pb=!0,l(),e(),$("#theEnd").css("display","inherit"),$("#time").text("Time: "+ab),$("#score").text("Score: "+X),bb=moment().format("DD/MM/YYYY"),$("#date").text("Date: "+bb),A.clearRect(0,0,z.width,z.height)}function h(){$("#save").attr("disabled",!1),pb=!1,B="play",a(),$("#theEnd").css("display","none"),j()}function i(){pb||(A.fillStyle="black",A.fillRect(J+8,K+93,67,29),A.fillStyle="red",A.fillRect(J+10,K+95,20,25),A.fillStyle="green",A.fillRect(J+10,K+95,cb,25))}function j(){_=setInterval(function(){Y++,C+=.05,mb+=.05,R+=.05,L+=.02},1e3)}function k(){for(var a=0;a<V.length;a++)J<V[a].x+lb&&J+H>V[a].x&&K<V[a].y+2*kb&&K+G>V[a].y&&(A.beginPath(),A.moveTo(V[a].x+15,V[a].y+110),A.lineTo(V[a].x+45,V[a].y+240),A.lineTo(V[a].x-20,V[a].y+240),A.moveTo(V[a].x+65,V[a].y+110),A.lineTo(V[a].x+100,V[a].y+240),A.lineTo(V[a].x+35,V[a].y+240),A.fillStyle="rgba(255,255,255,0.5)",A.fill(),A.lineWidth=.05,A.stroke())}function l(){pb||(A.font=nb,A.fillStyle=ob,Y>59&&(Z++,Y=0),ab=Y>=10?10>Z?"0"+Z+":"+Y:""+Z+":"+Y:10>Z?"0"+Z+":0"+Y:""+Z+":0"+Y,A.fillText("Time: "+ab,20,22),A.fillText("Score: "+X,20,50))}function m(a,b){a.length>20&&a.splice(0,5);for(var c=0;c<a.length;c++)a[c].y=a[c].y+C+4,A.beginPath(),b?(A.arc(a[c].x,a[c].y,20-c,0,2*Math.PI,!1),A.fillStyle="rgba(255,0,0,0.3)"):(A.arc(a[c].x,a[c].y-185,c,0,2*Math.PI,!1),A.fillStyle="rgba(255,255,0,0.3)"),A.fill(),A.lineWidth=.05,A.stroke()}function n(a,b,c){newSmoke={},newSmoke.x=a+H/2,newSmoke.y=b+G,c.push(newSmoke)}function o(){qb&&(sb=!0),(ub[37]||ub[65])&&J>15&&(qb?J>50&&(J-=50,qb=!1):rb&&(J-=L)),(ub[39]||ub[68])&&385>J&&(qb?350>J&&(J+=50,qb=!1):rb&&(J+=L)),(ub[38]||ub[87])&&K>0&&(qb?K>85&&(K-=75,qb=!1):rb&&(K-=L)),(ub[40]||ub[83])&&470>K&&(qb?405>K&&(K+=75,qb=!1):rb&&(K+=L)),A.drawImage(I,J,K),n(J,K,db),m(db,!0)}function p(){y>=z.height&&(y=0),y+=C,cb>0&&(cb-=.05),A.drawImage(F,0,y,E,D),A.drawImage(F,0,-z.height+y,E,D)}function q(){var a=0;gb||(Q[a].y>z.height||hb?(Q.splice(a,Q.length),gb=!0,hb&&(hb=!1)):(Q[a].y=Q[a].y+R,jb?A.drawImage(O,Q[a].x,Q[a].y,T,S):A.drawImage(N,Q[a].x,Q[a].y,T,S)))}function r(){var a=0;fb||(P[a].y>z.height||eb?(P.splice(a,P.length),fb=!0,eb&&(t(P,S,T),eb=!1)):fb||(P[a].y=P[a].y+R,A.drawImage(M,P[a].x,P[a].y,T,S)))}function s(){for(var a=0;a<V.length;a++)V[a].y>z.height?(V[a].x=sb?tb[Math.round(2*Math.random())]:Math.floor(Math.random()*(z.width-lb)),V[a].y=0-kb):(V[a].y=V[a].y+mb,A.drawImage(U,V[a].x,V[a].y,lb,kb),n(V[a].x,V[a].y,ib),m(ib,!1))}function t(a,b,c){newSprite={},newSprite.x=sb?tb[Math.round(2*Math.random())]:Math.floor(Math.random()*(z.width-c)),newSprite.y=0-b,a.push(newSprite)}function u(){var a=$("#nick").val(),b=JSON.parse(localStorage.getItem("klucz"));null===b?W.push({czas:ab,wynik:X,term:bb,imie:a}):(W=b,W.push({czas:ab,wynik:X,term:bb,imie:a}),W.sort(function(a,b){return b.wynik-a.wynik}),W.length>10&&W.splice(10,1));var c=JSON.stringify(W);localStorage.setItem("klucz",c)}function v(){for(var a=0;a<P.length;a++)J<P[a].x+T&&J+H>P[a].x&&K<P[a].y+S&&K+G>P[a].y&&(X+=10,eb=!0,63>=cb&&(35>cb?cb+=30:cb=65))}function w(){for(var a=0;a<V.length;a++)J<V[a].x+lb&&J+H>V[a].x&&K<V[a].y+kb&&K+G>V[a].y&&g();0>=cb&&g()}function x(){for(var a=0;a<Q.length;a++)J<Q[a].x+T&&J+H>Q[a].x&&K<Q[a].y+S&&K+G>Q[a].y&&(X+=jb?500:100,hb=!0)}var y,z=document.getElementById("myCanvas"),A=z.getContext("2d"),B="play",C=3,D=600,E=480,F=new Image;F.src="images/bgg.jpg";var G=124,H=82,I=new Image;I.src="images/cart2.png";var J=200,K=470,L=6,M=new Image;M.src="images/fuel.png";var N=new Image;N.src="images/gold.png";var O=new Image;O.src="images/silver.png";var P,Q,R=3,S=50,T=40,U=new Image;U.src="images/enemyCarT.png";var V,W,X,Y,Z,_,ab,bb,cb,db,eb,fb,gb,hb,ib,jb,kb=124,lb=82,mb=4,nb="17pt verdana",ob="rgb(255,255,255)",pb=!1;$("#save").on("click",function(){$("#nick").val().length>0&&(u(),$(this).attr("disabled",!0))}),$("#goToHighscores").on("click",function(){window.location="highscores.html"}),$("#replay").on("click",h);var qb,rb;$("#myCanvas").touchwipe({wipeLeft:function(){qb=!0,rb=!1,ub[39]=!1,ub[38]=!1,ub[37]=!0,ub[40]=!1},wipeRight:function(){qb=!0,rb=!1,ub[37]=!1,ub[39]=!0,ub[38]=!1,ub[40]=!1},wipeUp:function(){qb=!0,rb=!1,ub[38]=!1,ub[40]=!0,ub[37]=!1,ub[39]=!1},wipeDown:function(){qb=!0,rb=!1,ub[40]=!1,ub[38]=!0,ub[37]=!1,ub[39]=!1},min_move_x:20,min_move_y:20,preventDefaultEvents:!0}),"play"==B&&j();var sb=!1,tb=Array(60,220,370),ub={};window.addEventListener("keydown",function(a){ub[a.keyCode||a.which]=!0},!0),window.addEventListener("keyup",function(a){ub[a.keyCode||a.which]=!1},!0),$(document).keydown(function(a){var b=a.which;80==b&&("pause"==B?c():d()),"82"==b&&"play"==B&&f()}),window.addEventListener("load",a,!0),window.requestAnimationFrame||(window.requestAnimationFrame=function(){return window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)}}())});